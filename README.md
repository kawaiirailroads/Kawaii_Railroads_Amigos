# Kawaii Railroads Amigos

位置情報に応じて画像を表示させるアプリです。
みりめいの個人制作です。

## 概要

個人サイトでリリース予定の鉄道漫画×位置情報アプリです。
register.phpとregister_add.phpは
WordPress(以下WP)プラグイン「Simple WP Membership」(サブスク会員機能)との連携を前提とした会員登録方法をとっています。
なので現時点での応用範囲は狭められるかと思います。

今後はphpファイルのセキュリティなどを強固にしたうえで、
まずは「Kawaii Railroads Amigos」をサイトでリリースし、
その後にコードを広く使っていただけるよう整理する予定です。

## 基本仕様

・ユーザーが特定の位置に立ち「探検」をタップすると(geolocation.phpにアクセスすると)、その位置にまつわる漫画(画像)が表示される。
・ユーザーが会員登録済みかつログインしている場合は、一度開いた漫画をギャラリーに保存することができる。

　会員登録は、サブスクご支援者様限定であるため、大規模運用は想定していません。
　サブスク登録は：https://millie-may.net/wp/subscription

## データベース

MySQLを使用。ストレージエンジンはInnoDBです。
この実装ではふたつのテーブルを使用しています。

### members_tbl

WPプラグイン「Simple WP Membership」をインストールしたときに付属したテーブル。
今回はこれに、アプリ用ハンドルネームとアプリ用パスワード(それぞれamigos_handle, amigos_pass)を追加しました。

member_id 自動でカウントアップされるユニークな番号
user_name サブスクのユーザーID
email サブスクの登録メールアドレス
membership_level 会員レベル(INT、3以上が有料会員)
account_state アカウントの状態(activeだと有効、クレカ期限切れなど支払いが滞ると切り替わります)

amigos_handle アプリで使用するハンドルネーム
amigos_pass アプリで使用するパスワード(bcryptでハッシュ化)

ユーザーネームとメールアドレスをトリガーとして、上記アプリ用二項目を追加する実装をしました
(本当は既存のサブスク記事閲覧用パスワードと照合したかったのですが、WP独自のハッシュ化されたパスワードとの照合が難しく挫折。
なおユーザーネームとメールアドレスはともに他ユーザーや閲覧者に公開される機会はありません。)

### gallery_table

一意のIDとmembers_tblのメンバーID、漫画の情報が入った配列のIDを保存しています。
ログインユーザーのギャラリー保存機能に使用。

みりめい
https://millie-may.net